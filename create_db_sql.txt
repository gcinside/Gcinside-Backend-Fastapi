-- 테이블 순서는 관계를 고려하여 한 번에 실행해도 에러가 발생하지 않게 정렬되었습니다.

-- account_user Table Create SQL
CREATE TABLE account_user
(
    `user_id`        INT             NOT NULL    AUTO_INCREMENT, 
    `user_email`     VARCHAR(255)    NOT NULL, 
    `profile_image`  VARCHAR(100)    NOT NULL, 
    `user_name`      VARCHAR(20)     NOT NULL, 
    `join_date`      DATETIME        NOT NULL, 
    `is_superuser`   BOOLEAN         NOT NULL, 
    `is_staff`       BOOLEAN         NOT NULL, 
    CONSTRAINT PK_blog_category PRIMARY KEY (user_id)
);

CREATE INDEX blog_category_Index_2
    ON account_user(profile_image);

CREATE INDEX blog_category_Index_1
    ON account_user(user_id);


-- gallery_gallery Table Create SQL
CREATE TABLE gallery_gallery
(
    `gallery_id`           INT            NOT NULL    AUTO_INCREMENT, 
    `owner_id`             INT            NOT NULL, 
    `gallery_name`         VARCHAR(20)    NOT NULL, 
    `gallery_description`  LONGTEXT       NOT NULL, 
    CONSTRAINT PK_blog_post_to_category PRIMARY KEY (gallery_id)
);

CREATE INDEX blog_post_to_category_Index_1
    ON gallery_gallery(gallery_id);

CREATE INDEX blog_post_to_category_Index_2
    ON gallery_gallery(owner_id);

ALTER TABLE gallery_gallery
    ADD CONSTRAINT FK_gallery_gallery_owner_id_account_user_user_id FOREIGN KEY (owner_id)
        REFERENCES account_user (user_id) ON DELETE RESTRICT ON UPDATE RESTRICT;


-- post_post Table Create SQL
CREATE TABLE post_post
(
    `post_id`       INT             NOT NULL    AUTO_INCREMENT, 
    `author_id`     INT             NOT NULL, 
    `gallery_id`    INT             NOT NULL, 
    `post_title`    VARCHAR(120)    NOT NULL, 
    `post_content`  LONGTEXT        NOT NULL, 
    `post_image`    VARCHAR(255)    NOT NULL, 
    `created_at`    DATETIME        NOT NULL, 
    CONSTRAINT PK_blog_comment PRIMARY KEY (post_id)
);

CREATE INDEX blog_comment_Index_2
    ON post_post(author_id);

CREATE INDEX blog_comment_Index_3
    ON post_post(post_content);

CREATE INDEX blog_comment_Index_1
    ON post_post(post_id);

ALTER TABLE post_post
    ADD CONSTRAINT FK_post_post_author_id_account_user_user_id FOREIGN KEY (author_id)
        REFERENCES account_user (user_id) ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE post_post
    ADD CONSTRAINT FK_post_post_gallery_id_gallery_gallery_gallery_id FOREIGN KEY (gallery_id)
        REFERENCES gallery_gallery (gallery_id) ON DELETE RESTRICT ON UPDATE RESTRICT;


-- post_comment Table Create SQL
CREATE TABLE post_comment
(
    `comment_id`        INT         NOT NULL    AUTO_INCREMENT, 
    `author_id`         INT         NOT NULL, 
    `post_id`           INT         NOT NULL, 
    `comment_content`   LONGTEXT    NOT NULL, 
    `created_at`        DATETIME    NOT NULL, 
    `is_child_comment`  BOOLEAN     NOT NULL, 
    `comment_group`     INT         NULL, 
    CONSTRAINT PK_blog_post PRIMARY KEY (comment_id)
);

CREATE INDEX blog_post_Index_1
    ON post_comment(comment_id);

ALTER TABLE post_comment
    ADD CONSTRAINT FK_post_comment_author_id_account_user_user_id FOREIGN KEY (author_id)
        REFERENCES account_user (user_id) ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE post_comment
    ADD CONSTRAINT FK_post_comment_post_id_post_post_post_id FOREIGN KEY (post_id)
        REFERENCES post_post (post_id) ON DELETE RESTRICT ON UPDATE RESTRICT;


-- gallery_star Table Create SQL
CREATE TABLE gallery_star
(
    `star_id`     INT    NOT NULL    AUTO_INCREMENT, 
    `gallery_id`  INT    NOT NULL, 
    `user_id`     INT    NOT NULL, 
    CONSTRAINT PK_blog_tag PRIMARY KEY (star_id)
);

CREATE INDEX blog_tag_Index_2
    ON gallery_star(gallery_id);

CREATE INDEX blog_tag_Index_1
    ON gallery_star(star_id);

ALTER TABLE gallery_star
    ADD CONSTRAINT FK_gallery_star_user_id_account_user_user_id FOREIGN KEY (user_id)
        REFERENCES account_user (user_id) ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE gallery_star
    ADD CONSTRAINT FK_gallery_star_gallery_id_gallery_gallery_gallery_id FOREIGN KEY (gallery_id)
        REFERENCES gallery_gallery (gallery_id) ON DELETE RESTRICT ON UPDATE RESTRICT;


-- post_like Table Create SQL
CREATE TABLE post_like
(
    `like_id`    INT        NOT NULL    AUTO_INCREMENT, 
    `post_id`    INT        NOT NULL, 
    `user_id`    INT        NOT NULL, 
    `like_type`  BOOLEAN    NOT NULL, 
    CONSTRAINT PK_blog_related PRIMARY KEY (like_id)
);

ALTER TABLE post_like;

CREATE INDEX blog_related_Index_1
    ON post_like(like_id);

ALTER TABLE post_like
    ADD CONSTRAINT FK_post_like_user_id_account_user_user_id FOREIGN KEY (user_id)
        REFERENCES account_user (user_id) ON DELETE RESTRICT ON UPDATE RESTRICT;

ALTER TABLE post_like
    ADD CONSTRAINT FK_post_like_post_id_post_post_post_id FOREIGN KEY (post_id)
        REFERENCES post_post (post_id) ON DELETE RESTRICT ON UPDATE RESTRICT;


